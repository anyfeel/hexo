---
title: updns QPS 异常问题排查
date: 2018-09-24 10:46:32
tags:
---

## 环境问题排查
- 系统: 系统版本, 内核版本
- cpu: 物理核心数, 物理核数,逻辑核数
- 内存: 内存大小
- 网卡: 网卡是否是万兆, 驱动型号

## updns 版本确认（排查是否最近代码导致）
- 以前压测过的版本回退 v0.03
- 使用最近版本测试

## 系统各种参数优化确认
- sendmmsg recvmmsg
- 多线程发包
- so_reuseport
- 绑定网卡亲缘性
- 系统参数调优化
- 查看软件终端, 查看 cpu 绑定是否生效

## 使用系统工具确认压测机器是否正常
- iperf 网络ok, 吞吐量OK, QPS: 60s  400W QPS, 800Mb/s
- udp sender 查看发包 80w/s, 系统占用低
- perf spin_irq_lock 60%
- 查看网卡的收包, 接包, 丢包情况

## 被测端和压测端的情况
